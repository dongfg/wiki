<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>SVN服务器搭建 - dongfg' wiki</title>
    <meta name="keywords" content="java, python, linux, docker, wiki, simiki"/>
    <meta name="description" content="dongfg' personal wiki"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/">dongfg' wiki</a>
    &nbsp;&#187;&nbsp;
    <a href="/#linux">linux</a>
    &nbsp;&#187;&nbsp;SVN服务器搭建
    <span class="updated">Updated&nbsp;
    2017-08-16 13:53
    
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <blockquote>
<p>运行环境：CentOS 7+Apache+Php<br />
总览:</p>
</blockquote>
<p><img alt="" src="../../attach/svn.png" /></p>
<h2 id="_1">安装</h2>
<h3 id="apache">Apache</h3>
<div class="hlcode"><pre><span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">httpd</span> <span class="n">httpd</span><span class="o">-</span><span class="n">tools</span>
</pre></div>


<h3 id="subversion">Subversion</h3>
<div class="hlcode"><pre><span class="cp"># Apache svn模块mod_dav_svn</span>
<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">subversion</span> <span class="n">subversion</span><span class="o">-</span><span class="n">tools</span> <span class="n">mod_dav_svn</span>
</pre></div>


<h3 id="web">web管理界面</h3>
<div class="hlcode"><pre><span class="cp"># 安装PHP</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">php</span>

<span class="cp"># https:</span><span class="c1">//github.com/mfreiholz/iF.SVNAdmin</span>
<span class="cp"># 假设安装在/opt/svnadmin目录</span>
<span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">apache</span><span class="o">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">svnadmin</span>
</pre></div>


<h2 id="_2">配置</h2>
<h3 id="1-svneg-optsvnrepo">1. 创建SVN仓库存放的目录，eg : /opt/svnrepo</h3>
<div class="hlcode"><pre><span class="n">mkdir</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">svnrepo</span>
<span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">apache</span><span class="o">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">svnrepo</span>
</pre></div>


<h3 id="2-svn">2. 创建SVN系统管理员</h3>
<div class="hlcode"><pre><span class="n">htpasswd</span> <span class="o">-</span><span class="n">cm</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">svn</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">users</span> <span class="n">svnadmin</span>
<span class="n">chown</span> <span class="n">apache</span><span class="o">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">svn</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">users</span>
</pre></div>


<h3 id="3">3. 创建权限控制文件</h3>
<div class="hlcode"><pre><span class="cp"># touch /etc/svn-acl-conf</span>
<span class="cp"># chown apache: /etc/svn-acl-conf</span>
<span class="p">[</span><span class="o">/</span><span class="p">]</span>
<span class="o">*=</span><span class="n">r</span>
</pre></div>


<h3 id="4-apache">4. Apache 配置</h3>
<blockquote>
<p>vi /etc/httpd/conf/httpd.conf<br />
修改原有80端口，添加8080, 9080两个端口<br />
Listen 8080<br />
Listen 9080<br />
添加<code>RequestHeader edit Destination ^https http early</code></p>
</blockquote>
<p>/etc/httpd/conf.modules.d/11-subversion.conf</p>
<div class="hlcode"><pre><span class="nt">&lt;VirtualHost</span> <span class="err">*:8080</span><span class="nt">&gt;</span>
    ServerName localhost
    ServerAlias localhost

    LoadModule dav_svn_module     modules/mod_dav_svn.so
    LoadModule authz_svn_module   modules/mod_authz_svn.so
    LoadModule dontdothat_module  modules/mod_dontdothat.so

    LimitXMLRequestBody 0 
    LimitRequestBody 0

    <span class="nt">&lt;Location</span> <span class="nt">/&gt;</span>
        DAV svn
        SVNListParentPath on
        SVNParentPath /opt/svnrepo
        AuthType Basic
        AuthName &quot;Subversion repositories&quot;
        AuthUserFile /etc/svn-auth-users
        AuthzSVNAccessFile /etc/svn-acl-conf
        Require valid-user
    <span class="nt">&lt;/Location&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>


<p>/etc/httpd/conf.modules.d/12-svnadmin.conf</p>
<div class="hlcode"><pre><span class="nt">&lt;VirtualHost</span> <span class="err">*:9080</span><span class="nt">&gt;</span>
    DirectoryIndex index.php
        DocumentRoot /opt/svnadmin
    ServerName localhost
    RewriteEngine on
    RewriteRule ^index\.html$ index.php$1 <span class="cp">[</span><span class="nx">L</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="mi">301</span><span class="cp">]</span>

    <span class="nt">&lt;Directory</span> <span class="err">&quot;/opt/svnadmin&quot;</span><span class="nt">&gt;</span>
        Options Indexes FollowSymLinks
        Require all granted
        <span class="nt">&lt;/Directory&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>


<h3 id="5-nginx">5. Nginx配置</h3>
<div class="hlcode"><pre><span class="n">client_max_body_size</span>     <span class="mi">1024</span><span class="n">m</span><span class="p">;</span>
<span class="n">server</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="n">location</span> <span class="o">/</span><span class="n">svnadmin</span><span class="p">{</span>
        <span class="n">proxy_set_header</span> <span class="n">X</span><span class="o">-</span><span class="n">Real</span><span class="o">-</span><span class="n">IP</span>  <span class="err">$</span><span class="n">remote_addr</span><span class="p">;</span>
        <span class="n">proxy_set_header</span> <span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">For</span> <span class="err">$</span><span class="n">remote_addr</span><span class="p">;</span>
        <span class="n">proxy_set_header</span> <span class="n">Host</span> <span class="err">$</span><span class="n">host</span><span class="p">;</span>
        <span class="n">proxy_pass</span> <span class="n">http</span><span class="o">:</span><span class="c1">//127.0.0.1:9080/;</span>
    <span class="p">}</span>

    <span class="n">location</span> <span class="o">^~</span> <span class="o">/</span><span class="p">{</span>
        <span class="n">proxy_set_header</span> <span class="n">X</span><span class="o">-</span><span class="n">Real</span><span class="o">-</span><span class="n">IP</span>  <span class="err">$</span><span class="n">remote_addr</span><span class="p">;</span>
        <span class="n">proxy_set_header</span> <span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">For</span> <span class="err">$</span><span class="n">remote_addr</span><span class="p">;</span>
        <span class="n">proxy_set_header</span> <span class="n">Host</span> <span class="err">$</span><span class="n">host</span><span class="p">;</span>
        <span class="n">proxy_pass</span> <span class="n">http</span><span class="o">:</span><span class="c1">//127.0.0.1:8080;</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>


<h3 id="6-svnadmin">6. SVNAdmin配置</h3>
<p>Subversion 授权文件 --&gt; /etc/svn-acl-conf 用户身份验证文件 --&gt; /etc/svn-auth-users 代码仓库的父目录 --&gt; /opt/svnrepo</p>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2025 <a href='https://dongfg.com'>dongfg</a>.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://git.coding.net/tankywoo/yasimple_x2.git" target="_blank">YASimple_X2</a>.
        </p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>Site Generated 2025-08-01 15:30:19</p>
      </div> <!-- end footer-right -->
    </div>

    
    
  </body>
</html>